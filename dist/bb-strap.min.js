!function(a,b){!function(a){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],a):a(jQuery,_,Backbone)}(function(c,d,e){e.safeSync="abort",e.bindings=!0,e.defaultTemplateManager="remote",e.attachOptions=!0,e.$compile=function(a){return d.isFunction(a)?a.apply(this,[].slice.call(arguments,1)):d.template.apply(d,arguments)},e.$attach=function(a,b){return d.extend(a,b)};var f=e.sync;e.sync=function(a,b,c){var g=c||{};if(!e.safeSync||g.safe===!1)return f.apply(this,arguments);b.$xhr||(b.$xhr={});var h=b.$xhr[a];if(h){var i=g.safe||e.safeSync;if("abort"===i)h.abort();else if("skip"===i)return h}var j=c.success,k=c.error,l=function(){b.$xhr[a]=null,j=k=l=null};c.success=function(){j.apply(this,arguments),l()},c.error=function(){d.isFunction(k)&&k.apply(this,arguments),l()};var m=f.apply(this,arguments);return b.$xhr[a]=m,m};var g=d.keys(e.Model.prototype);e.Model=function(a){return a.extend({constructor:function(b,c){e.attachOptions&&c&&e.$attach(this,d.omit(c,g)),a.apply(this,arguments)}})}(e.Model);var h=d.keys(e.Collection.prototype);return e.Collection=function(a){return a.extend({constructor:function(b,c){e.attachOptions&&c&&e.$attach(this,d.omit(c,h)),a.apply(this,arguments)}})}(e.Collection),e.View=function(a){return a.extend({constructor:function(b){e.attachOptions&&e.$attach(this,d.defaults(b||{},d.result(this,"defaults"))),a.apply(this,arguments),this.setSubscriptions(),this.model&&this.bindings&&this.bind(this.model,this.bindings)}})}(e.View),d.extend(e.View.prototype,{$readData:function(a,b){var c=e.$,f=c("#"+a),g=c.trim(f.text()),h=b||a,i=d.isString(h)?this[h]:h;if(g&&i){var j=JSON.parse(g);i.set(j)}return f.remove(),i},isEmpty:function(){return!e.$.trim(this.$el.html())},loader:"icon-loader",classLoading:"loading",$showLoader:function(){var a=this.$loader,b=d.result(this,"loader"),c=d.result(this,"classLoading");return!a&&b&&(a=e.$("<i>").addClass(b),this.$el.addClass(c).html(a),this.$loader=a),this},$hideLoader:function(){return this.$loader&&(this.$el.removeClass(d.result(this,"classLoading")),this.$loader.remove(),this.$loader=null),this},onDispose:function(){},dispose:function(){return this.trigger("dispose",this),this.onDispose(),this.undelegateEvents(),this.stopListening(),this.unsetSubscriptions(),this},remove:function(){return this.dispose(),this.trigger("close",this),this.$el.remove(),this.$destroy(),this},close:function(){return this.remove()},clear:function(){return this.dispose(),this.trigger("clear",this),this.$el.empty(),this.$destroy(),this},$destroy:function(){var a=function(a,b){this[b]=null};return d.each(this,a,this),this},bind:function(a,b){return a=a||this.model,b=b||this.bindings,a&&b&&d.each(b,function(b,c){var d="change:"+b;this.stopListening(a,d),this.listenTo(a,d,function(a,b){this.$(c).text(b)})},this),this},setSubscriptions:function(a){var b=a||this.subscriptions;if(b&&!d.isEmpty(b)){this.unsetSubscriptions(b);var c=function(a,b){var c=!!a.once;d.isString(a)&&(a=this[a]),e.Mediator.sub(b,a,this,c)};d.each(b,c,this)}return this},unsetSubscriptions:function(a){var b=a||this.subscriptions;if(b&&!d.isEmpty(b)){var c=function(a,b){d.isString(a)&&(a=this[a]),e.Mediator.unsubscribe(b,a,this)};d.each(b,c,this)}return this}}),e.Mediator={$channels:{},subscribe:function(a,b,c,d){var f=e.Mediator.$channels;f[a]||(f[a]=[]),f[a].push({fn:b,ctx:c,once:d||!1})},subscribeOnce:function(a,b,c){e.Mediator.sub(a,b,c,!0)},publish:function(a){var b=e.Mediator.$channels,c=b[a];if(c){var f=[].slice.call(arguments,1);e.Mediator.$channels[a]=d.reject(c,function(a){return a.fn.apply(a.ctx,f),a.once})}},unsubscribe:function(a,b,c){var f=d.size(arguments);if(!f)return void(e.Mediator.$channels={});var g=e.Mediator.$channels,h=g[a];if(h){var i=[];f>1&&(i=d.reject(h,function(a){return a.fn===b&&(!c||a.ctx===c)})),e.Mediator.$channels[a]=i}}},e.Mediator.sub=e.Mediator.subscribe,e.Mediator.subOnce=e.Mediator.subscribeOnce,e.Mediator.pub=e.Mediator.publish,e.InlineTemplateManager=function(){this.initialize.apply(this,arguments)},e.InlineTemplateManager.prototype={initialize:function(){},$get:function(a,b){var c=a;d.isObject(a)&&(c=a.tmpl,a=a.id),b.call(this,c,a)},$load:function(a,b,c){this.$get(a,function(a,d){b.call(c,a,d)})},$loads:function(a,b,c){var e={},f=d.size(a),g=d.after(f,function(){b.call(c,e)}),h=function(a,b){e[b]=a,g()},i=function(a){this.$get(a,h)};d.each(a,i,this)},load:function(a,b,c){var e=d.isArray(a)?"$loads":"$load";this[e](a,b,c)}},e.inlineTemplateManager=new e.InlineTemplateManager,e.DOMTemplateManager=function(){this.$cache={},this.initialize.apply(this,arguments)},d.extend(e.DOMTemplateManager.prototype,e.InlineTemplateManager.prototype,{$get:function(a,b){var c=this.$cache;c[a]=c[a]||e.$(a),b.call(this,c[a].html(),a)},$clear:function(a){a?delete this.$cache[a]:this.$cache={}}}),e.domTemplateManager=new e.DOMTemplateManager,e.RemoteTemplateManager=function(a){var b=this,c=a||{};b.$cache={},b.prefix=c.prefix||"/templates/",b.suffix=c.suffix||".template.html",b.initialize.apply(b,arguments)},d.extend(e.RemoteTemplateManager.prototype,e.DOMTemplateManager.prototype,{$get:function(a,b){var c=this.$cache;c[a]=c[a]||e.$.get(this.$url(a)),c[a].done(function(c){b.call(this,c,a)})},$url:function(a){return this.prefix+a+this.suffix}}),e.remoteTemplateManager=new e.RemoteTemplateManager,e.App=e.View.extend({el:"body",constructor:function(){a.app=this;var c=e.$;this.$window=c(a),this.$document=c(b),this.$body=c("body"),this.$html=c("html"),this.$html.addClass("js").removeClass("no-js");var d=a.location;this.url=d.protocol+"//"+d.host+d.pathname,this.views={},this.router=null,e.View.apply(this,arguments)},events:{"click .js-link":"nav"},nav:function(a){a.preventDefault(),this.navigate(e.$(a.currentTarget).attr("href"))},navigate:function(a,b){var c=this.router;return c&&(d.isUndefined(b)&&(b=!0),a=a.replace(this.url,""),c.navigate(a,{trigger:!!b})),this},scrollTop:function(a){return this.$window.scrollTop(a||0),this}}),e.Router=function(a){return a.extend({constructor:function(b){if(a.apply(this,arguments),!e.history.started){var c=b||{},f={silent:!1,pushState:!0};e.history.start(d.extend(f,d.pick(c,"silent","pushState")))}}})}(e.Router),e.CompositeView=e.View.extend({constructor:function(a){this.$subviews={},this.$cache={};var b=e.defaultTemplateManager;b&&(this.tmplManager=e[b+"TemplateManager"]),e.View.apply(this,arguments);var c=a||{};this.onInit(c),this.isEmpty()?this.postInit(c):(this.onReady(c),this.onRendered())},onInit:function(){},postInit:function(){this.render()},onReady:function(){},toJSON:function(){return{}},dispose:function(){return e.View.prototype.dispose.apply(this,arguments),this.$clear(),this.$closeSubviews(),this},$c:function(a){var b=this.$cache;return d.has(b,a)||(b[a]=this.$(a)),b[a]},$clear:function(a){return a?delete this.$cache[a]:this.$cache={},this},$closeSubview:function(){var a=[].slice.call(arguments),b=function(a){var b=d.isString(a)?a:a.cid,c=this.$subviews[b];c&&(this.stopListening(c),c.remove(),delete this.$subviews[b])};return d.each(a,b,this),this},$closeSubviews:function(){d.each(this.$subviews,this.$closeSubview,this);var a=function(a,b){a instanceof e.View&&(a.remove(),this[b]=null)};return d.each(this,a,this),this},$addSubview:function(){var a=[].slice.call(arguments),b=function(a){this.listenToOnce(a,"dispose",this.$closeSubView),this.$subviews[a.cid]=a};return d.each(a,b,this),this},$readSubview:function(a,b,c){var e=[],f=function(a,f){var g=c||{};d.isFunction(g)&&(g=g.call(this,f,a)),g.el||(g.el=a),e.push(new b(g))};return d.each(this.$(a),f,this),this.$addSubview.apply(this,e)},append:function(a,b){var c=b?this.$(b):this.$el;return c.append(a.$el),this.$addSubview(a),this},appendCollection:function(a,b,c,d){return a.each(function(a){this.appendModel(a,b,c,d)},this),this},appendModel:function(a,b,c,e){var f={};return c?f=d.isFunction(c)?c.call(this,a):d.clone(c):f.model=a,this.append(new b(f),e)},$size:function(){return d.size(this.$subviews)},onRendered:function(){},preRender:function(){},render:function(){var a=d.result(this,"templates");return a?this.tmplManager.load(a,this.$loaded,this):this.$el.empty(),this},$partials:function(a){var b={};return d.each(a,function(a,c){var e=c.split("/"),f=d.last(e);b[f]=a}),b},$loaded:function(a){if(d.isString(a))this.$populate(a);else{var b=a[d.result(this,"templates")[0]],c=d.extend(this.$partials(a),d.result(this,"partials"));this.$populate(b,c)}return this},$populate:function(){this.trigger("render:start",this),this.preRender(),this.$clear(),this.$closeSubviews();var a=this.toHTML.apply(this,arguments);return this.$el.html(a),this.onRendered(),this.trigger("render:end",this),this},toHTML:function(a,b){var c=d.result(this,"toJSON");return this.$compile(a,c,b)},$compile:function(){return e.$compile.apply(null,arguments)}}),e})}(window,window.document);